<!DOCTYPE html>  
<html lang="ar" dir="rtl">  
<head>   
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#D32F2F">  
    <meta name="mobile-web-app-capable" content="yes">  
    <meta name="apple-mobile-web-capable" content="yes">  
    <meta name="apple-mobile-app-status-bar-style" content="black-translucent">  
    <meta name="description" content="Ù…ØªØ¬Ø± ZOONA Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø§Ù„ØªØ³ÙˆÙ‚ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">  
    <meta name="keywords" content="zoona, Ù…ØªØ¬Ø±, ØªØ³ÙˆÙ‚, Ø³ÙˆØ¯Ø§Ù†ÙŠ, Ø´Ø±Ø§Ø¡, Ù…Ù†ØªØ¬Ø§Øª, Ø³ÙˆØ¯Ø§Ù†">  
    <meta name="author" content="ZOONA">  
    <title>ZOONA</title>  
    <link rel="manifest" href="manifest.json">  
    <link rel="icon" type="image/png" href="icon/icon-72x72.png">  
    <link rel="apple-touch-icon" href="icon/icon-152x152.png">  
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">  
  
<style>  
    * {  
        margin: 0;  
        padding: 0;  
        box-sizing: border-box;  
        -webkit-tap-highlight-color: transparent;  
    }  
      
    body, html {  
        width: 100%;  
        height: 100%;  
        overflow: hidden;  
        font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, sans-serif;  
        background: #FFFFFF;  
        position: fixed;  
    }  
      
    #splash {  
        position: fixed;  
        top: 0;  
        left: 0;  
        width: 100%;  
        height: 100%;  
        background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);  
        display: flex;  
        flex-direction: column;  
        justify-content: center;  
        align-items: center;  
        z-index: 9999;  
        transition: opacity 0.5s;  
    }  
      
    .splash-logo {  
        width: 150px;  
        height: 150px;  
        margin-bottom: 20px;  
        animation: pulse 2s infinite;  
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));  
    }  
      
    .splash-text {  
        color: white;  
        font-size: 20px;  
        font-weight: 700;  
        margin-top: 20px;  
        letter-spacing: 1px;  
        font-family: 'Tajawal', sans-serif;  
    }  
      
    .loader {  
        width: 60px;  
        height: 4px;  
        background: rgba(255,255,255,0.3);  
        margin-top: 30px;  
        border-radius: 2px;  
        overflow: hidden;  
    }  
      
    .loader::after {  
        content: '';  
        display: block;  
        width: 50%;  
        height: 100%;  
        background: white;  
        border-radius: 2px;  
        animation: loading 1.5s infinite ease-in-out;  
    }  
      
    @keyframes pulse {  
        0% { transform: scale(1); }  
        50% { transform: scale(1.05); }  
        100% { transform: scale(1); }  
    }  
      
    @keyframes loading {  
        0% { transform: translateX(-100%); }  
        100% { transform: translateX(200%); }  
    }  
      
    #webview-container {  
        width: 100%;  
        height: 100%;  
        display: none;  
    }  
      
    #webview {  
        width: 100%;  
        height: 100%;  
        border: none;  
        background: #FFFFFF;  
    }  
      
    .status-bar {  
        height: env(safe-area-inset-top, 0px);  
        background: #D32F2F;  
        width: 100%;  
    }  
      
    #back-button {  
        position: fixed;  
        bottom: 25px;  
        left: 25px;  
        background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);  
        color: white;  
        width: 56px;  
        height: 56px;  
        border-radius: 28px;  
        display: none;  
        justify-content: center;  
        align-items: center;  
        box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);  
        z-index: 1000;  
        border: none;  
        cursor: pointer;  
        font-size: 22px;  
        font-weight: bold;  
        transition: all 0.3s ease;  
        font-family: 'Tajawal', sans-serif;  
    }  
      
    #back-button:hover {  
        transform: scale(1.1);  
        box-shadow: 0 8px 25px rgba(211, 47, 47, 0.5);  
    }  
      
    #back-button:active {  
        transform: scale(0.95);  
    }  
      
    #toast {  
        position: fixed;  
        bottom: 90px;  
        left: 50%;  
        transform: translateX(-50%);  
        background: #D32F2F;  
        color: white;  
        padding: 16px 32px;  
        border-radius: 28px;  
        display: none;  
        z-index: 1001;  
        box-shadow: 0 8px 25px rgba(211, 47, 47, 0.3);  
        font-weight: 600;  
        max-width: 85%;  
        text-align: center;  
        backdrop-filter: blur(10px);  
        border: 1px solid rgba(255,255,255,0.1);  
        font-family: 'Tajawal', sans-serif;  
        font-size: 15px;  
        animation: slideUp 0.3s ease-out;  
    }  
      
    @keyframes slideUp {  
        from {  
            opacity: 0;  
            transform: translateX(-50%) translateY(20px);  
        }  
        to {  
            opacity: 1;  
            transform: translateX(-50%) translateY(0);  
        }  
    }  
      
    .offline-message {  
        position: fixed;  
        top: 0;  
        left: 0;  
        width: 100%;  
        background: #B71C1C;  
        color: white;  
        text-align: center;  
        padding: 16px;  
        display: none;  
        z-index: 1002;  
        font-weight: 600;  
        box-shadow: 0 4px 12px rgba(183, 28, 28, 0.3);  
        font-family: 'Tajawal', sans-serif;  
        font-size: 15px;  
    }  
      
    #refresh-button {  
        position: fixed;  
        bottom: 25px;  
        right: 25px;  
        background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);  
        color: white;  
        width: 56px;  
        height: 56px;  
        border-radius: 28px;  
        display: none;  
        justify-content: center;  
        align-items: center;  
        box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);  
        z-index: 1000;  
        border: none;  
        cursor: pointer;  
        font-size: 22px;  
        transition: all 0.3s ease;  
        font-family: 'Tajawal', sans-serif;  
    }  
      
    #refresh-button:hover {  
        transform: rotate(30deg);  
    }  
      
    /* ØªØ­Ø³ÙŠÙ† Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø³Ø­Ø¨ */  
    .pull-indicator {  
        position: fixed;  
        top: -80px;  
        left: 0;  
        width: 100%;  
        height: 80px;  
        background: linear-gradient(to bottom, #D32F2F, #B71C1C);  
        display: flex;  
        justify-content: center;  
        align-items: center;  
        color: white;  
        z-index: 999;  
        transition: top 0.3s ease;  
        font-family: 'Tajawal', sans-serif;  
        font-weight: 600;  
        font-size: 16px;  
        padding-top: env(safe-area-inset-top, 0px);  
    }  
      
    .pull-indicator.show {  
        top: 0;  
    }  
      
    .pull-indicator .icon {  
        margin-left: 10px;  
        font-size: 20px;  
        transition: transform 0.3s;  
    }  
      
    .background-pattern {  
        position: fixed;  
        top: 0;  
        left: 0;  
        width: 100%;  
        height: 100%;  
        background-image:   
            radial-gradient(circle at 25% 25%, rgba(211, 47, 47, 0.03) 0%, transparent 50%),  
            radial-gradient(circle at 75% 75%, rgba(183, 28, 28, 0.03) 0%, transparent 50%);  
        pointer-events: none;  
        z-index: -1;  
    }  
      
    .welcome-message {  
        position: fixed;  
        top: 20px;  
        right: 20px;  
        background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);  
        color: white;  
        padding: 12px 24px;  
        border-radius: 25px;  
        z-index: 1003;  
        box-shadow: 0 6px 20px rgba(211, 47, 47, 0.3);  
        font-family: 'Tajawal', sans-serif;  
        font-weight: 700;  
        font-size: 15px;  
        display: none;  
        animation: fadeInDown 0.5s ease-out;  
        border: 2px solid rgba(255,255,255,0.2);  
    }  
      
    @keyframes fadeInDown {  
        from {  
            opacity: 0;  
            transform: translateY(-20px);  
        }  
        to {  
            opacity: 1;  
            transform: translateY(0);  
        }  
    }  
</style>

</head>  
<body id="zoona-app" data-app-type="webview" data-store="sudan">  
    <div class="background-pattern"></div>
    <div class="status-bar"></div>
    <div class="welcome-message" id="welcome-message">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø± ZOONA Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ</div>
    <div class="pull-indicator" id="pull-indicator">
        <span>Ø­Ø±Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</span>
        <span class="icon">âŸ³</span>
    </div>
    <div id="splash">  
        <img src="assets/splash-logo.png" alt="ZOONA Logo" class="splash-logo">  
        <div class="splash-text">ZOONA</div>  
        <div class="loader"></div>  
    </div>
    <div class="offline-message" id="offline-message">âš ï¸ Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø®Ø²Ù†Ø©.</div>
    <div id="webview-container">  
        <iframe id="webview"   
                allow="geolocation; camera; microphone; autoplay; clipboard-write; encrypted-media"  
                allowfullscreen  
                sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-downloads"  
                referrerpolicy="strict-origin-when-cross-origin"  
                title="Ù…ØªØ¬Ø± ZOONA Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ"></iframe>  
    </div>
    <button id="back-button" aria-label="Ø±Ø¬ÙˆØ¹">â†</button>  
    <button id="refresh-button" aria-label="ØªØ­Ø¯ÙŠØ«">â†»</button>
    <div id="toast"></div>
  
<script>  
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ù…ØªØºÙŠØ± url  
    const params = new URLSearchParams(window.location.search);  
    let siteURL = params.get("url");  

    // Ø§Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· â†’ Ù†ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©  
    if (!siteURL) {  
        siteURL = "https://www.zoonasd.com/";  
    }  

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©  
    const appName = "ZOONA";  
    const webview = document.getElementById("webview");  
    const splash = document.getElementById("splash");  
    const webviewContainer = document.getElementById('webview-container');  
    const backButton = document.getElementById('back-button');  
    const refreshButton = document.getElementById('refresh-button');  
    const toast = document.getElementById('toast');  
    const offlineMessage = document.getElementById('offline-message');  
    const welcomeMessage = document.getElementById('welcome-message');  
    const pullIndicator = document.getElementById('pull-indicator');  
    const appBaseURL = window.location.origin + window.location.pathname;
    
    // Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    const APP_URL = "https://app.zoonasd.com";
      
    // ØªØ¹ÙŠÙŠÙ† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚  
    document.title = appName;  
      
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø¯ÙŠØ«  
    let startY = 0;  
    let currentY = 0;  
    let isPulling = false;  
    let pullStartTime = 0;  
    let isRefreshing = false;
    
    // Ù…ØªØºÙŠØ±Ø§Øª ØªØªØ¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·
    let currentPageURL = siteURL;
    let lastUpdateTime = 0;
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØµÙØ­
    function updateBrowserURL(url) {
        try {
            const now = Date.now();
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 500ms ÙÙ‚Ø· Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
            if (now - lastUpdateTime < 500) return;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const newURL = `${APP_URL}/?url=${encodeURIComponent(url)}`;
            currentPageURL = url;
            lastUpdateTime = now;
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            if (window.history && window.history.replaceState) {
                const stateObj = { 
                    url: url,
                    timestamp: now
                };
                window.history.replaceState(stateObj, '', newURL);
                console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰:', newURL);
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
                updatePageTitle();
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø·:', error);
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
    function updatePageTitle() {
        try {
            if (webview.contentWindow && webview.contentWindow.document) {
                const pageTitle = webview.contentWindow.document.title;
                if (pageTitle && pageTitle !== "" && pageTitle !== "ZOONA") {
                    document.title = `${pageTitle} | ${appName}`;
                } else {
                    document.title = appName;
                }
            }
        } catch (e) {
            document.title = appName;
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù€ iframe Ù„Ø·Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
    function requestCurrentURL() {
        try {
            if (webview.contentWindow) {
                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ù„Ø¨
                webview.contentWindow.postMessage({ 
                    type: "get_current_url",
                    requestId: Date.now()
                }, "*");
            }
        } catch (e) {
            // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®Ø²Ù†
            updateBrowserURL(currentPageURL);
        }
    }
      
    // ØªÙ‡ÙŠØ¦Ø© Service Worker  
    if ('serviceWorker' in navigator) {  
        window.addEventListener('load', () => {  
            navigator.serviceWorker.register('service-worker.js')  
                .then(registration => {  
                    console.log('ServiceWorker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ù„ØªØ·Ø¨ÙŠÙ‚ ZOONA');  
                })  
                .catch(err => {  
                    console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ ServiceWorker:', err);  
                });  
        });  
    }  
      
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª  
    function showToast(message, duration = 3000) {  
        toast.textContent = message;  
        toast.style.display = 'block';  
          
        setTimeout(() => {  
            toast.style.display = 'none';  
        }, duration);  
    }  
      
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨  
    function showWelcomeMessage() {  
        const today = new Date().toDateString();  
        const lastWelcomeDate = localStorage.getItem('zoona_last_welcome_date');  
          
        if (lastWelcomeDate !== today) {  
            welcomeMessage.style.display = 'block';  
            localStorage.setItem('zoona_last_welcome_date', today);  
              
            setTimeout(() => {  
                welcomeMessage.style.display = 'none';  
            }, 5000);  
              
            showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£ÙƒØ¨Ø± Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© ğŸ‡¸ğŸ‡©', 3000);  
        }  
    }  
      
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„  
    function showOfflineMessage() {  
        offlineMessage.style.display = 'block';  
        showToast('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„', 3000);  
          
        setTimeout(() => {  
            offlineMessage.style.display = 'none';  
        }, 5000);  
    }  
      
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª  
    function updateOnlineStatus() {  
        if (navigator.onLine) {  
            offlineMessage.style.display = 'none';  
              
            if (!isPulling) {  
                pullIndicator.classList.remove('show');  
            }  
        } else {  
            showOfflineMessage();  
        }  
    }  
      
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„  
    window.addEventListener('online', updateOnlineStatus);  
    window.addEventListener('offline', updateOnlineStatus);  
      
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ Ù„Ø£Ø³ÙÙ„ Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø³Ù†
    document.addEventListener('touchstart', (e) => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
        const isAtTop = window.scrollY <= 5;
        
        if (isAtTop && !isPulling && !isRefreshing) {
            startY = e.touches[0].clientY;
            currentY = startY;
            isPulling = true;
            pullStartTime = Date.now();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ø´Ø±
            pullIndicator.style.top = '-80px';
            pullIndicator.querySelector('.icon').style.transform = 'rotate(0deg)';
        }
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!isPulling) return;
        
        currentY = e.touches[0].clientY;
        const pullDistance = currentY - startY;
        
        if (pullDistance > 0) {
            e.preventDefault();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰
            const maxPull = 150;
            const calculatedTop = Math.min(pullDistance, maxPull) - 80;
            pullIndicator.style.top = calculatedTop + 'px';
            
            // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ©
            const iconRotation = Math.min((pullDistance / maxPull) * 360, 360);
            pullIndicator.querySelector('.icon').style.transform = `rotate(${iconRotation}deg)`;
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ©
            if (pullDistance > 100) {
                pullIndicator.querySelector('span:first-child').textContent = 'Ø­Ø±Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©';
                pullIndicator.classList.add('show');
            } else {
                pullIndicator.querySelector('span:first-child').textContent = 'Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø¯ÙŠØ«';
                pullIndicator.classList.remove('show');
            }
        }
    });
    
    document.addEventListener('touchend', () => {
        if (!isPulling) return;
        
        const pullDistance = currentY - startY;
        const pullDuration = Date.now() - pullStartTime;
        
        isPulling = false;
        
        // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¨Ø³Ù„Ø§Ø³Ø©
        pullIndicator.style.transition = 'top 0.3s ease';
        pullIndicator.style.top = '-80px';
        
        setTimeout(() => {
            pullIndicator.style.transition = '';
        }, 300);
        
        // Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø­Ø¨ 100 Ø¨ÙƒØ³Ù„ ÙˆÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© Ø£Ù‚Ù„ Ù…Ù† Ø«Ø§Ù†ÙŠØ©
        if (pullDistance > 100 && pullDuration < 1000) {
            isRefreshing = true;
            pullIndicator.classList.remove('show');
            
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©...', 1500);
            
            // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            if (webview.contentWindow) {
                setTimeout(() => {
                    webview.contentWindow.location.reload();
                    isRefreshing = false;
                }, 300);
            }
        } else if (pullDistance > 50) {
            // Ø³Ø­Ø¨ ØºÙŠØ± ÙƒØ§ÙÙŠØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø¨Ø³Ù„Ø§Ø³Ø©
            pullIndicator.querySelector('.icon').style.transform = 'rotate(0deg)';
        }
    });
      
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚  
    document.addEventListener('DOMContentLoaded', () => {  
        updateOnlineStatus();  
          
        // Ù…Ø­Ø§ÙƒØ§Ø© ÙˆÙ‚Øª ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø©  
        setTimeout(() => {  
            loadWebview();  
        }, 2000);  
          
        // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©  
        backButton.addEventListener('click', () => {  
            if (webview.contentWindow && webview.contentWindow.history.length > 1) {  
                webview.contentWindow.history.back();  
                showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', 1500);  
            }  
        });  
          
        // Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«  
        refreshButton.addEventListener('click', () => {  
            if (webview.contentWindow) {  
                showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©...', 1500);  
                webview.contentWindow.location.reload();  
            }  
        });  
          
        // ØªØ­Ø¯ÙŠØ« Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…  
        setInterval(() => {  
            try {  
                // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©  
                if (webview.contentWindow && webview.contentWindow.history.length > 1) {  
                    backButton.style.display = 'flex';  
                } else {  
                    backButton.style.display = 'none';  
                }  
                  
                // Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«  
                if (webview.contentWindow) {  
                    refreshButton.style.display = 'flex';  
                }  
            } catch (e) {  
                backButton.style.display = 'none';  
                refreshButton.style.display = 'none';  
            }  
        }, 1000);  
    });  
      
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹  
    function loadWebview() {  
        webview.src = siteURL;  
          
        webview.onload = () => {  
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„  
            splash.style.opacity = '0';  
            setTimeout(() => {  
                splash.style.display = 'none';  
                webviewContainer.style.display = 'block';  
            }, 500);  
              
            // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            updateBrowserURL(siteURL);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·  
            setTimeout(() => {  
                showWelcomeMessage();  
            }, 1000);  
              
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            setupNavigationMonitoring();
              
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙÙŠØ¯ Ø¨Ø£Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²  
            try {  
                webview.contentWindow.postMessage({  
                    type: 'app_ready',  
                    app_name: 'ZOONA Store',  
                    country: 'Sudan',  
                    features: {  
                        storage: true,  
                        geolocation: true,  
                        download: true,  
                        version: '1.0.0',  
                        currency: 'SDG'  
                    }  
                }, '*');  
            } catch (e) {  
                console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¥Ø·Ø§Ø±');  
            }  
        };  
          
        webview.onerror = () => {  
            splash.innerHTML = `  
                <div style="text-align: center; color: white; padding: 20px; font-family: 'Tajawal', sans-serif;">  
                    <h2 style="margin-bottom: 20px; font-weight: 700;">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h2>  
                    <p style="margin-bottom: 30px; font-size: 16px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>  
                    <button onclick="location.reload()" style="  
                        margin-top: 20px;  
                        padding: 12px 40px;  
                        background: white;  
                        color: #D32F2F;  
                        border: none;  
                        border-radius: 25px;  
                        font-size: 16px;  
                        cursor: pointer;  
                        font-weight: bold;  
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);  
                        font-family: 'Tajawal', sans-serif;  
                        transition: all 0.3s;  
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)';"  
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)';">  
                        Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©  
                    </button>  
                </div>  
            `;  
            showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 4000);  
        };  
    }
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙ†Ù‚Ù„
    function setupNavigationMonitoring() {
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù€ iframe
        window.addEventListener('message', handleIframeMessage);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ ÙØ§ØµÙ„ Ø²Ù…Ù†ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·
        const checkInterval = setInterval(() => {
            requestCurrentURL();
        }, 1000);
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ù„Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
        setupNavigationMonitoring.checkInterval = checkInterval;
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù€ iframe
    function handleIframeMessage(event) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ø¥Ø¶Ø§ÙÙŠ Ù‡Ù†Ø§)
        
        if (event.data && event.data.type === "current_url_response") {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯
            const url = event.data.url;
            if (url && url !== currentPageURL) {
                updateBrowserURL(url);
            }
        }
        
        if (event.data && event.data.type === "page_changed") {
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø©
            const url = event.data.url;
            if (url) {
                updateBrowserURL(url);
            }
        }
    }
      
    // ------------ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ ------------  
    window.addEventListener("message", function(event) {  
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰
        switch(event.data?.type) {
            case "request_location":
                navigator.geolocation.getCurrentPosition(  
                    (pos) => {  
                        webview.contentWindow.postMessage({  
                            status: "success",  
                            latitude: pos.coords.latitude,  
                            longitude: pos.coords.longitude,  
                            accuracy: pos.coords.accuracy,  
                            timestamp: pos.timestamp  
                        }, "*");  
                    },  
                    (err) => {  
                        webview.contentWindow.postMessage({  
                            status: "error",  
                            message: err.message,  
                            code: err.code  
                        }, "*");  
                    },  
                    {  
                        enableHighAccuracy: true,  
                        timeout: 15000,  
                        maximumAge: 0  
                    }  
                );
                break;
                
            case "download_file":
                const { url, filename, type } = event.data;  
                downloadFile(url, filename, type);
                break;
                
            case "save_data":
                const { key, value } = event.data;  
                localStorage.setItem(`zoona_${key}`, JSON.stringify(value));  
                webview.contentWindow.postMessage({  
                    type: "data_saved",  
                    key: key,  
                    success: true  
                }, "*");  
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“', 2000);
                break;
                
            case "get_data":
                const dataKey = event.data.key;  
                const storedValue = localStorage.getItem(`zoona_${dataKey}`);  
                webview.contentWindow.postMessage({  
                    type: "data_retrieved",  
                    key: dataKey,  
                    value: storedValue ? JSON.parse(storedValue) : null,  
                    success: true  
                }, "*");
                break;
                
            case "clear_data":
                const clearKey = event.data.key;  
                if (clearKey === 'all') {  
                    localStorage.clear();  
                    showToast('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 2000);  
                } else {  
                    localStorage.removeItem(`zoona_${clearKey}`);  
                    showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 2000);  
                }
                break;
                
            case "update_url":
                const newUrl = event.data.url;
                if (newUrl) {
                    updateBrowserURL(newUrl);
                }
                break;
                
            case "current_url_response":
            case "page_changed":
                // ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ ÙÙŠ handleIframeMessage
                break;
        }
    });
      
    // Ø¯Ø§Ù„Ø© ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª  
    function downloadFile(url, filename, type = 'image') {  
        showToast(`Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„ ${filename}... â³`, 3000);  
          
        const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');  
        const finalFilename = `${filename.replace(/\.[^/.]+$/, "")}_${timestamp}${filename.match(/\.[^/.]+$/)?.[0] || ''}`;  
          
        fetch(url, {  
            mode: 'cors',  
            credentials: 'include'  
        })  
        .then(response => {  
            if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');  
            return response.blob();  
        })  
        .then(blob => {  
            const url = window.URL.createObjectURL(blob);  
            const a = document.createElement('a');  
            a.style.display = 'none';  
            a.href = url;  
            a.download = finalFilename;  
            a.setAttribute('download', finalFilename);  
              
            document.body.appendChild(a);  
            a.click();  
            window.URL.revokeObjectURL(url);  
            a.remove();  
              
            showToast(`ØªÙ… ØªÙ†Ø²ÙŠÙ„ ${filename} Ø¨Ù†Ø¬Ø§Ø­ âœ…`, 3000);  
              
            webview.contentWindow.postMessage({  
                type: "download_complete",  
                filename: finalFilename,  
                originalName: filename,  
                success: true,  
                timestamp: new Date().toISOString()  
            }, "*");  
              
            const downloads = JSON.parse(localStorage.getItem('zoona_downloads') || '[]');  
            downloads.unshift({  
                filename: finalFilename,  
                originalName: filename,  
                type: type,  
                date: new Date().toISOString(),  
                url: url  
            });  
            localStorage.setItem('zoona_downloads', JSON.stringify(downloads.slice(0, 50)));  
        })  
        .catch(err => {  
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„:', err);  
            showToast('ÙØ´Ù„ Ø§Ù„ØªÙ†Ø²ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 3000);  
              
            webview.contentWindow.postMessage({  
                type: "download_complete",  
                filename: filename,  
                success: false,  
                error: err.message  
            }, "*");  
        });  
    }  
      
    // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©  
    document.addEventListener('contextmenu', e => {  
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {  
            e.preventDefault();  
        }  
    });  
      
        // Ø¯Ø¹Ù… Ø§Ù„ØªØ«Ø¨ÙŠØª ÙƒÙ€ PWA (Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)  
    let deferredPrompt;  
      
    window.addEventListener('beforeinstallprompt', (e) => {  
        e.preventDefault();  
        deferredPrompt = e;  
        // Ù„Ø§ ØªØ¸Ù‡Ø± Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„ØªØ«Ø¨ÙŠØª  
    });  
      
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©  
    window.addEventListener('load', () => {  
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©  
        const now = new Date().getTime();  
        const cacheData = JSON.parse(localStorage.getItem('zoona_cache_meta') || '{}');  
          
        for (const key in cacheData) {  
            if (now - cacheData[key].timestamp > 7 * 24 * 60 * 60 * 1000) { // 7 Ø£ÙŠØ§Ù…  
                localStorage.removeItem(key);  
                delete cacheData[key];  
            }  
        }  
          
        localStorage.setItem('zoona_cache_meta', JSON.stringify(cacheData));  
    });  
      
    // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡  
    let isScrolling;  
    window.addEventListener('scroll', () => {  
        window.clearTimeout(isScrolling);  
          
        isScrolling = setTimeout(() => {  
            backButton.style.opacity = '0.7';  
            refreshButton.style.opacity = '0.7';  
              
            setTimeout(() => {  
                backButton.style.opacity = '1';  
                refreshButton.style.opacity = '1';  
            }, 100);  
        }, 66);  
    }, false);  
      
    // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…  
    if (!localStorage.getItem('zoona_first_use')) {  
        localStorage.setItem('zoona_first_use', new Date().toISOString());  
    }  
</script>

<!-- Firebase Messaging for PWA on Blogger -->  <script type='module'>  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";  
  import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-messaging.js";  
  
  const firebaseConfig = {  
    apiKey: "AIzaSyBxQLDLqr4W3lApfYLPjSV5It7925a9Rr0",  
    authDomain: "double-carport-476915-j7.firebaseapp.com",  
    projectId: "double-carport-476915-j7",  
    storageBucket: "double-carport-476915-j7.firebasestorage.app",  
    messagingSenderId: "122641462099",  
    appId: "1:122641462099:web:345b777a88757d3ef7e7a6"  
  };  
  
  const app = initializeApp(firebaseConfig);  
  const messaging = getMessaging(app);  
  
  if ('serviceWorker' in navigator) {  
    navigator.serviceWorker.register('/service-worker.js', { scope: '/' })  
      .then(registration => {  
        console.log('Service Worker registered:', registration);  
  
        Notification.requestPermission().then(permission => {  
          if (permission === "granted") {  
            //  Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: ØªÙ…Ø±ÙŠØ± ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (registration)  
            getToken(messaging, {   
              vapidKey: "BE2_9m83w2cu_fxhqV4eUowZQT7E8nm-FZZMWqN5DByd-Naykp52nWwA9uuW_L9x_3rPPsMNZzctsZD8j5YyaZw",  
              serviceWorkerRegistration: registration   
            })  
            .then(token => {  
              if (token) {  
                console.log("FCM Token:", token);  
  
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù€ token Ø¥Ù„Ù‰ Vercel API  
                fetch('/api/saveToken', {  
                  method: 'POST',  
                  headers: { 'Content-Type': 'application/json' },  
                  body: JSON.stringify({ token })  
                });  
              } else {  
                console.log('No registration token available.');  
              }  
            })  
            .catch(err => console.error('Error retrieving token: ', err));  
          } else {  
            console.log('Notification permission not granted');  
          }  
        });  
  
      })  
      .catch(err => console.error('Service Worker registration failed:', err));  
  } else {  
    console.warn('Service Worker not supported in this browser');  
  }  
</script>  <!-- ØµÙ†Ø¯ÙˆÙ‚ ØªØ«Ø¨ÙŠØª PWA (Ù†Ø³Ø®Ø© Ù…ÙˆØ­Ø¯Ø©) -->  <div style="  
position: fixed;  
right: 16px;  
left: 16px;  
bottom: 20px;  
max-width: 420px;  
margin: 0 auto;  
border-radius: 20px; /* Ø²Ø§ÙˆÙŠØ© Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© */  
padding: 24px; /* Ù…Ø³Ø§Ø­Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ø£ÙƒØ¨Ø± */  
background: #ffffff; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ø¸ÙŠÙØ© */  
color: #333333; /* Ù„ÙˆÙ† Ù†Øµ Ø¯Ø§ÙƒÙ† */  
box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15),   
            0 4px 12px rgba(0, 0, 0, 0.05); /* Ø¸Ù„Ø§Ù„ Ø£ÙƒØ«Ø± Ø¹Ù…Ù‚Ù‹Ø§ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ© */  
display: none;  
z-index: 100000;  
font-family: 'Tajawal', 'Segoe UI', Tahoma, sans-serif;  
direction: rtl;  
"  
id="pwa-install-box" aria-hidden="true" role="dialog">  <div id="pwa-close" title="Ø¥ØºÙ„Ø§Ù‚" style="  
    position:absolute;top:12px;left:12px;color:#999;font-size:20px;  
    cursor:pointer;width:32px;height:32px;display:flex;  
    align-items:center;justify-content:center;border-radius:50%;  
    transition: color 0.3s, background-color 0.3s;  
">  
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>  
</div>  
  
<div style="display:flex;gap:16px;align-items:center;">  
      
    <div style="  
        width: 72px; /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */  
        height: 72px;  
        border-radius: 18px; /* Ø²ÙˆØ§ÙŠØ§ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø­Ø¯Ø«Ø© */  
        background: #f7f7f7;  
        display:flex;align-items:center;justify-content:center;  
        flex-shrink:0;box-shadow: 0 4px 12px rgba(0,0,0,0.1);  
        overflow:hidden;  
    ">  
        <img src="https://i.ibb.co/pvjQjT2V/icon-512x512.png"   
             style="width: 52px; height: 52px; border-radius: 10px; object-fit: cover;">  
    </div>  

    <div style="flex:1;text-align:right;">  
        <div style="font-weight: 800; font-size: 18px; margin-bottom: 4px; color: #c62828;">  
            ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ <span style="font-family:'Segoe UI', Tahoma, sans-serif;">ZOONA</span>  
        </div>  
        <div style="font-size: 14px; color: #555555; line-height: 1.5;">  
            âœ¨ ØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø§Ø¡ Ø£Ø³Ø±Ø¹ â€” ØªØ«Ø¨ÙŠØª Ù…Ø¨Ø§Ø´Ø± Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©  
        </div>  
    </div>  

</div>  

<button id="pwa-install-btn" style="  
    width: 100%; /* Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ */  
    margin-top: 20px;   
    background: #c62828; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ù‚ÙˆÙŠ */  
    color: #fff;  
    border: none;  
    padding: 14px 20px;  
    border-radius: 14px;  
    font-weight: 700;  
    cursor: pointer;  
    box-shadow: 0 8px 20px rgba(198, 40, 40, 0.3),  
                inset 0 1px 0 rgba(255, 255, 255, 0.3); /* Ø¸Ù„Ø§Ù„ ÙˆØ²Ø± Ù…Ù…ÙŠØ² */  
    text-align: center;  
    font-size: 16px;  
    letter-spacing: 0.5px;  
    transition: background-color 0.3s ease;  
">  
    ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù† ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙØ§Ø¦Ù‚  
</button>

</div>  <script>  
document.addEventListener('DOMContentLoaded', function() {  
    let deferredPrompt = null;  
    const box = document.getElementById('pwa-install-box');  
    const btn = document.getElementById('pwa-install-btn');  
    const close = document.getElementById('pwa-close');  
  
    // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Tajawal Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…ØªÙ†Ø§Ø³Ù‚  
    const f = document.createElement('link');  
    f.rel = "stylesheet";  
    f.href = "https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap";  
    document.head.appendChild(f);  
  
    function hasShownBefore() {  
        return localStorage.getItem('pwaInstallShown') === 'true';  
    }  
    function markAsShown() {  
        localStorage.setItem('pwaInstallShown', 'true');  
    }  
  
    function isInstalled() {  
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨ØªØ§Ù‹ ÙƒÙ€ PWA  
        return window.matchMedia('(display-mode: standalone)').matches ||  
               window.navigator.standalone === true;  
    }  
  
    window.addEventListener('beforeinstallprompt', (e) => {  
        e.preventDefault();  
        deferredPrompt = e;  
  
        if (isInstalled()) return;  
        if (hasShownBefore()) return;  
  
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± 3 Ø«ÙˆØ§Ù†Ù  
        setTimeout(() => {  
            box.style.display = 'block';  
        }, 3000);  
    });  
  
    btn.addEventListener('click', async () => {  
        if (!deferredPrompt) {  
            box.style.display = 'none';  
            markAsShown();  
            return;  
        }  
  
        deferredPrompt.prompt();  
        await deferredPrompt.userChoice;  
  
        box.style.display = 'none';  
        markAsShown();  
        deferredPrompt = null;  
    });  
  
    close.addEventListener('click', () => {  
        box.style.display = 'none';  
        markAsShown(); // ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© "ØªÙ… Ø§Ù„Ø¹Ø±Ø¶" Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠØ¯ÙˆÙŠ  
    });  
  
    if (isInstalled()) {  
        box.style.display = 'none';  
    }  
});  
</script>  <!-- Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø²ÙˆÙ†Ø§ -->  <div id="custom-notification-prompt" style="  
    position: fixed;   
    bottom: 20px;   
    left: 50%;   
    transform: translateX(-50%);   
    z-index: 10000;   
    background-color: #fff;   
    border: 2px solid #ff4500;   
    border-radius: 18px;   
    padding: 25px;   
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);   
    max-width: 500px;   
    width: 90%;   
    display: none;   
    text-align: center;   
    font-family: 'Tajawal', sans-serif;  
    animation: promptSlideUp 0.5s ease forwards;  
">  
    <div style="color: #ff4500; font-weight: 800; margin-bottom: 15px; font-size: 1.4rem; display: flex; align-items: center; justify-content: center; gap: 10px;">  
        <span>Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‡Ø¯Ø§ÙŠØ§ Ø­ØµØ±ÙŠØ© Ù…Ù† Ø²ÙˆÙ†Ø§ØŸ</span>  
    </div>  <p style="color: #444; margin-bottom: 25px; font-size: 1.1rem; line-height: 1.6;">  
    ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¢Ù† Ù„ØªØµÙ„Ùƒ Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ© ÙˆØ®ØµÙˆÙ…Ø§Øª Ù…Ù…ÙŠØ²Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¬Ù…ÙŠØ¹!  
</p>  
  
<div style="background-color: #fff9f7; border-radius: 12px; padding: 15px; margin-bottom: 25px; text-align: right;">  
    <div style="display: flex; align-items: center; justify-content: flex-end; margin-bottom: 10px; color: #555;">  
        <span>Ø®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ 50%</span>  
        <span style="color: #ff4500; margin-left: 8px; font-size: 1.2rem;"></span>  
    </div>  
    <div style="display: flex; align-items: center; justify-content: flex-end; margin-bottom: 10px; color: #555;">  
        <span>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ø¹Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span>  
        <span style="color: #ff4500; margin-left: 8px; font-size: 1.2rem;">âš¡</span>  
    </div>  
    <div style="display: flex; align-items: center; justify-content: flex-end; color: #555;">  
        <span>Ù‡Ø¯Ø§ÙŠØ§ Ù…Ø¬Ø§Ù†ÙŠØ©</span>  
        <span style="color: #ff4500; margin-left: 8px; font-size: 1.2rem;"></span>  
    </div>  
</div>  
  
<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 15px;">  
    <button id="activate-notifications" style="  
        background-color: #ff4500;   
        color: white;   
        border: none;   
        padding: 14px 28px;   
        border-radius: 12px;   
        font-weight: 700;   
        cursor: pointer;   
        transition: all 0.3s ease;   
        font-size: 1.05rem;   
        flex: 1;   
        min-width: 160px;   
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.25);  
    ">  
        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù† â¤ï¸â€  
    </button>  
    <button id="decline-notifications" style="  
        background-color: #f0f2f5;   
        color: #666;   
        border: 1px solid #ddd;   
        padding: 14px 28px;   
        border-radius: 12px;   
        font-weight: 700;   
        cursor: pointer;   
        transition: all 0.3s ease;   
        font-size: 1.05rem;   
        flex: 1;   
        min-width: 160px;  
    ">  
        Ø¹Ø¯Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„  
    </button>  
</div>  
  
<p style="margin-top: 20px; color: #888; font-size: 0.9rem;">  
    ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­  
</p>

</div>  <style>  
    @keyframes promptSlideUp {  
        from {  
            opacity: 0;  
            transform: translateX(-50%) translateY(30px);  
        }  
        to {  
            opacity: 1;  
            transform: translateX(-50%) translateY(0);  
        }  
    }  
      
    @media (max-width: 768px) {  
        #custom-notification-prompt {  
            padding: 20px;  
            width: 95%;  
            border-radius: 16px;  
        }  
          
        #custom-notification-prompt > div:first-child {  
            font-size: 1.3rem;  
        }  
          
        #custom-notification-prompt p {  
            font-size: 1rem;  
        }  
          
        #activate-notifications, #decline-notifications {  
            padding: 12px 20px;  
            font-size: 1rem;  
            min-width: 140px;  
        }  
    }  
      
    @media (max-width: 480px) {  
        #custom-notification-prompt {  
            padding: 18px;  
            border-radius: 14px;  
        }  
          
        #custom-notification-prompt > div:first-child {  
            font-size: 1.2rem;  
            flex-direction: column;  
            gap: 5px;  
        }  
          
        #activate-notifications, #decline-notifications {  
            width: 100%;  
            min-width: unset;  
        }  
    }  
</style>  <script type='module'>  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";  
  import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-messaging.js";  
  
  const firebaseConfig = {  
    apiKey: "AIzaSyBxQLDLqr4W3lApfYLPjSV5It7925a9Rr0",  
    authDomain: "double-carport-476915-j7.firebaseapp.com",  
    projectId: "double-carport-476915-j7",  
    storageBucket: "double-carport-476915-j7.firebasestorage.app",  
    messagingSenderId: "122641462099",  
    appId: "1:122641462099:web:345b777a88757d3ef7e7a6"  
  };  
    
  const VAPID_KEY = "BE2_9m83w2cu_fxhqV4eUowZQT7E8nm-FZZMWqN5DByd-Naykp52nWwA9uuW_L9x_3rPPsMNZzctsZD8j5YyaZw";  
  
  const app = initializeApp(firebaseConfig);  
  const messaging = getMessaging(app);  
  
  /**  
   * Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Token Firebase ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…  
   * @param {ServiceWorkerRegistration} registration - ØªØ³Ø¬ÙŠÙ„ Service Worker Ø§Ù„Ù†Ø´Ø·  
   */  
  function requestAndSaveToken(registration) {  
      // 1. Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­  
      Notification.requestPermission().then(permission => {  
          if (permission === "granted") {  
              // 2. Ø¥Ø°Ø§ ØªÙ… Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù†ØŒ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Token  
              getToken(messaging, {   
                  vapidKey: VAPID_KEY,  
                  serviceWorkerRegistration: registration   
              })  
              .then(token => {  
                  if (token) {  
                      console.log("FCM Token:", token);  
                      // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù€ token Ø¥Ù„Ù‰ Vercel API  
                      fetch('/api/saveToken', {  
                          method: 'POST',  
                          headers: { 'Content-Type': 'application/json' },  
                          body: JSON.stringify({ token })  
                      })  
                      .then(response => {  
                          if (response.ok) {  
                              console.log('Token saved successfully');  
                              // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…  
                              alert('âœ… Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ! Ø³ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙ†Ø§ Ø§Ù„Ø­ØµØ±ÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹.');  
                          } else {  
                              console.error('Failed to save token');  
                          }  
                      })  
                      .catch(error => console.error('Error saving token:', error));  
                  } else {  
                      console.log('No registration token available.');  
                  }  
              })  
              .catch(err => console.error('Error retrieving token: ', err));  
          } else {  
              console.log('Notification permission not granted');  
              alert('âŒ Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù†. Ù„Ù† ØªØµÙ„Ùƒ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙ†Ø§.');  
          }  
      });  
  }  
  
  if ('serviceWorker' in navigator) {  
    navigator.serviceWorker.register('/service-worker.js', { scope: '/' })  
      .then(registration => {  
        console.log('Service Worker registered:', registration);  
          
        const promptContainer = document.getElementById('custom-notification-prompt');  
  
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ Ø±ÙØ¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹  
        const userDeclined = localStorage.getItem('zona_notifications_declined');  
  
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø°Ù† Ø§Ù„Ø­Ø§Ù„ÙŠØ©  
        if (Notification.permission === 'default' && !userDeclined) {  
              
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØµØµØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·  
            setTimeout(() => {  
                if (promptContainer) {  
                    promptContainer.style.display = 'block';  
                }  
            }, 3000); // ØªØ£Ø®ÙŠØ± 3 Ø«ÙˆØ§Ù†ÙŠ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£ÙˆÙ„Ø§Ù‹  
  
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø®ØµØµØ©  
            const activateBtn = document.getElementById('activate-notifications');  
            const declineBtn = document.getElementById('decline-notifications');  
  
            if (activateBtn) {  
                activateBtn.addEventListener('click', () => {  
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØµØµØ©  
                    if (promptContainer) promptContainer.style.display = 'none';  
                    // ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† ÙˆØ¬Ù„Ø¨ Ø§Ù„Ù€ Token  
                    requestAndSaveToken(registration);  
                });  
            }  
              
            if (declineBtn) {  
                declineBtn.addEventListener('click', () => {  
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØµØµØ©  
                    if (promptContainer) promptContainer.style.display = 'none';  
                    // ØªØ®Ø²ÙŠÙ† ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø±ÙØ¶ ÙÙŠ localStorage Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¸Ù‡ÙˆØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰  
                    localStorage.setItem('zona_notifications_declined', 'true');  
                    alert(' Ù„Ù† ØªØµÙ„Ùƒ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙ†Ø§ Ø§Ù„Ø­ØµØ±ÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø±Ø§Ø± Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.');  
                    console.log('User declined custom prompt for now.');  
                });  
            }  
  
        } else if (Notification.permission === 'granted') {  
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø°Ù† Ù…Ù…Ù†ÙˆØ­Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù‚Ù… ÙÙ‚Ø· Ø¨Ø¬Ù„Ø¨/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ Token (Ù„Ø¶Ù…Ø§Ù† ØªØ³Ø¬ÙŠÙ„Ù‡)  
            console.log('Ø§Ù„Ø¥Ø°Ù† Ù…Ù…Ù†ÙˆØ­ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ Token...');  
            getToken(messaging, {   
                vapidKey: VAPID_KEY,  
                serviceWorkerRegistration: registration   
            })  
            .then(token => {  
                if (token) {  
                    console.log("FCM Token updated:", token);  
                }  
            })  
            .catch(err => console.error('Error updating token: ', err));  
        } else if (Notification.permission === 'denied') {  
            console.log('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ù…Ø³Ø¨Ù‚Ø§Ù‹');  
        }  
  
      })  
      .catch(err => console.error('Service Worker registration failed:', err));  
  } else {  
    console.warn('Service Worker not supported in this browser');  
  }  
    
  // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± hover Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±  
  document.addEventListener('DOMContentLoaded', function() {  
      const activateBtn = document.getElementById('activate-notifications');  
      const declineBtn = document.getElementById('decline-notifications');  
        
      if (activateBtn) {  
          activateBtn.addEventListener('mouseenter', function() {  
              this.style.backgroundColor = '#e03e00';  
              this.style.transform = 'translateY(-2px)';  
              this.style.boxShadow = '0 6px 16px rgba(255, 69, 0, 0.3)';  
          });  
            
          activateBtn.addEventListener('mouseleave', function() {  
              this.style.backgroundColor = '#ff4500';  
              this.style.transform = 'translateY(0)';  
              this.style.boxShadow = '0 4px 12px rgba(255, 69, 0, 0.25)';  
          });  
      }  
        
      if (declineBtn) {  
          declineBtn.addEventListener('mouseenter', function() {  
              this.style.backgroundColor = '#e4e6e9';  
              this.style.transform = 'translateY(-2px)';  
          });  
            
          declineBtn.addEventListener('mouseleave', function() {  
              this.style.backgroundColor = '#f0f2f5';  
              this.style.transform = 'translateY(0)';  
          });  
      }  
  });  
</script> 
</body> 
</html>  